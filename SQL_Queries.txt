1) List all crops based on the regions of the farmers.
--> 
SELECT
	USERID,
	FIRSTNAME,
	MIDDLENAME,
	LASTNAME,
	CONTACTNO
FROM
	REGISTERS R
	JOIN FARMER F ON R.USERID = F.FARMERID
	NATURAL JOIN PINCODETABLE P1
WHERE
	DISTRICT = 'Ahmedabad'


2) Find the total transaction amount between a particular buyer and a particular farmer.
-->

SELECT
	SUM(QTYBOUGHT * RATE) AS TOTAL_TRANSACTION_AMOUNT
FROM
	BUYERSUPPLYTRANSACTION B
	JOIN DISPLAYCROP D ON B.FARMERID = D.FARMERID
	AND B.CROPID = D.CROPID
WHERE
	B.FARMERID = 'F2400001'
	AND B.BUYERID = 'B2400006'
GROUP BY
	B.FARMERID,
	B.BUYERID



3) Get the average rating of a particular transport provider, based on feedback from Buyer.
-->
SELECT
	TRANSPORTPROVIDERID,
	AVG(TRANSPORTPROVIDERRATING) AS AVG_TRANSPORTPROVIDER_RATING
FROM
	BUYERSUPPLYTRANSACTION
WHERE
	TRANSPORTPROVIDERID IS NOT NULL
	AND TRANSPORTPROVIDERRATING IS NOT NULL
GROUP BY
	TRANSPORTPROVIDERID
ORDER BY
	AVG_TRANSPORTPROVIDER_RATING DESC;

4) Find the lowest price for a particular item.
-->
SELECT
	DIS.DEALERID,
	R.ITEMID,
	R.ITEMNAME,
	PRICE
FROM
	(
		SELECT
			I.ITEMID,
			I.ITEMNAME,
			MIN(RATE) AS PRICE
		FROM
			DISPLAYITEM D
			JOIN ITEM I ON D.ITEMID = I.ITEMID
		WHERE
			I.ITEMID = 'I024'
		GROUP BY
			I.ITEMID
	) AS R
	JOIN DISPLAYITEM DIS ON R.ITEMID = DIS.ITEMID

5)Calculate the average early delivery time for a particular transport provider.
-->
SELECT
	TRANSPORTPROVIDERID,
	AVG((DELIVERYDATE - DELIVEREDDATE)) AS AVG_EARLY_DELIVERY_DAYS
FROM
	BUYERSUPPLYTRANSACTION
GROUP BY
	TRANSPORTPROVIDERID
ORDER BY
	AVG_EARLY_DELIVERY_DAYS DESC


6) Find the number of total pending deliveries for a particular transport provider.
-->
SELECT
	TRANSPORTPROVIDERID,
	COUNT(*) AS PENDING_DELIVERIES
FROM
	FARMERSUPPLYTRANSACTION
WHERE
	TRANSPORTPROVIDERID = 'T2400009'
	AND STATUS = 'Accepted'
GROUP BY
	TRANSPORTPROVIDERID;


7) List farmers in descending order based on the total quantity of a particular crop they have sold.
-->
SELECT
	FARMERID,
	SUM(QTYBOUGHT) AS TOTALQTYSOLD
FROM
	BUYERSUPPLYTRANSACTION
WHERE
	STATUS = 'Delivered'
	AND CROPID = 'G001'
GROUP BY
	FARMERID
ORDER BY
	TOTALQTYSOLD DESC;

8) List the totalcost of a particular crop bought by a buyer from different farmers.
-->
SELECT
	BST.BUYERID,
	BST.FARMERID,
	C.CROPNAME,
	SUM(BST.QTYBOUGHT * DC.RATE + BST.FREIGHTCHARGES) AS TOTALCOST
FROM
	BUYERSUPPLYTRANSACTION BST
	JOIN DISPLAYCROP DC ON BST.CROPID = DC.CROPID
	AND BST.FARMERID = DC.FARMERID
	JOIN CROP C ON BST.CROPID = C.CROPID
WHERE
	BST.CROPID = 'G006'
	AND BST.BUYERID = 'B2400006'
GROUP BY
	BST.BUYERID,
	BST.FARMERID,
	C.CROPNAME;



9) List the top crops that were purchased the Most by buyers (based on total quantity bought).
-->
SELECT
	C.CROPID,
	C.CROPNAME,
	SUM(BST.QTYBOUGHT) AS TOTALQUANTITYBOUGHT
FROM
	BUYERSUPPLYTRANSACTION BST
	JOIN CROP C ON BST.CROPID = C.CROPID
WHERE
	STATUS = 'Delivered'
GROUP BY
	C.CROPID,
	C.CROPNAME
ORDER BY
	TOTALQUANTITYBOUGHT DESC;



10) List the top 10 farmers based on total revenue earned.
-->
SELECT
	B.FARMERID,
	R.FIRSTNAME,
	R.LASTNAME,
	SUM(B.QTYBOUGHT * DC.RATE) AS TR
FROM
	BUYERSUPPLYTRANSACTION AS B
	JOIN DISPLAYCROP AS DC ON B.CROPID = DC.CROPID
	AND B.FARMERID = DC.FARMERID
	JOIN REGISTERS AS R ON B.FARMERID = R.USERID
GROUP BY
	B.FARMERID,
	R.FIRSTNAME,
	R.LASTNAME
ORDER BY
	TR DESC
LIMIT
	10;



11)Find the farmers who sell all the crops.
-->SELECT
	F.FARMERID
FROM
	FARMER F
WHERE
	NOT EXISTS (
		SELECT
			C.CROPID
		FROM
			CROP AS C
		WHERE
			NOT EXISTS (
				SELECT
					1
				FROM
					DISPLAYCROP AS DC
				WHERE
					DC.FARMERID = F.FARMERID
					AND DC.CROPID = C.CROPID
			)
	);


12)List the transport providers who have never made a late delivery.
-->
SELECT DISTINCT
	R.USERID AS TRANSPORTPROVIDERID,
	R.FIRSTNAME,
	R.LASTNAME
FROM
	REGISTERS R
	JOIN FARMERSUPPLYTRANSACTION FST ON R.USERID = FST.TRANSPORTPROVIDERID
WHERE
	R.USERID NOT IN (
		SELECT
			TRANSPORTPROVIDERID
		FROM
			FARMERSUPPLYTRANSACTION
		WHERE
			DELIVEREDDATE > DELIVERYDATE
	);



13)List the top 3 farmers from a particular city based on their rating.
-->
SELECT
	REGISTERS.FIRSTNAME,
	REGISTERS.LASTNAME AS FARMER_NAME,
	AVG(BUYERSUPPLYTRANSACTION.FARMERRATING) AS AVG_RATING,
	PINCODETABLE.CITY
FROM
	BUYERSUPPLYTRANSACTION
	JOIN REGISTERS ON BUYERSUPPLYTRANSACTION.FARMERID = REGISTERS.USERID
	JOIN ADDRESS ON BUYERSUPPLYTRANSACTION.PINCODE = ADDRESS.PINCODE
	AND BUYERSUPPLYTRANSACTION.ADDRESSLINE = ADDRESS.ADDRESSLINE
	JOIN PINCODETABLE ON ADDRESS.PINCODE = PINCODETABLE.PINCODE
WHERE
	PINCODETABLE.CITY = 'ahmedabad'
GROUP BY
	REGISTERS.FIRSTNAME,
	REGISTERS.LASTNAME,
	PINCODETABLE.CITY
ORDER BY
	AVG_RATING DESC
LIMIT 3;


14) Give me the transaction IDs for which the distance is less than a particular value and the weight is greater than a particular value.
--> 
SELECT
	B.TRANSACTIONID
FROM
	BUYERSUPPLYTRANSACTION AS B
	JOIN DISPLAYCROP AS DC ON B.CROPID = DC.CROPID
	AND B.FARMERID = DC.FARMERID
WHERE
	B.DISTANCE < 100
	AND (B.QTYBOUGHT * DC.WEIGHTPERQTY) > 200;



15) List all items that are currently on sale by dealers.
-->
SELECT DISTINCT
	ITEM.ITEMNAME,
	DISPLAYITEM.QTYONSELL,
	DISPLAYITEM.RATE
FROM
	DISPLAYITEM
	JOIN ITEM ON DISPLAYITEM.ITEMID = ITEM.ITEMID
WHERE
	DEALERID = 'D2400004'